---
title: 第三章 指令系统与汇编语言程序设计
date: 2021-05-16 15:30:00
permalink: /SMC&P/note/3
author: 
    name: eric
    href: https://wfmiss.cn
---
# 第三章 指令系统与汇编语言程序设计

```txt
三、指令系统与汇编语言程序设计
（一）知识范围
指令系统的概念、指令格式；
对操作数的寻址方式；
常用指令（传送指令、算术运算指令、逻辑运算和移位指令、串操作指令、程序控制指令与处理器控制指令）；
汇编语言程序的基本结构；
常用伪指令（数据定义、符号定义、段定义、设定段寄存器）；
DOS功能调用（输入/输出字符、输入/输出字符串、结束程序）；
三种结构（顺序结构、分支结构和循环结构）程序设计；
常用程序设计举例。
（二）考核要求
1.	理解指令系统的概念及指令格式。
2.	掌握常用的寻址方式并能熟练地使用它们。
3.	掌握常用指令的格式、功能和使用方法，分析各种指令执行后的结果。
4.	掌握指令对状态标志的影响。
5.	掌握常用伪指令的格式和功能。
6.	掌握汇编语言源程序的构成，熟练掌握汇编语言程序上机调试运行过程。
7.	理解程序的三种基本结构，能够使用汇编语言解决常见的问题。
```

## 1. 指令系统及指令格式

特点：

- 指令系统的兼容性
- 指令系统的灵活性
- 寻址方式的多样性
- 可对多种类型的数据进行处理
- 可构成多处理机系统

**指令：**控制计算完成特定操作的命令

**指令系统：**指令系统是计算机能够执行全部命令的集合，它其取决于计算机的硬件设计。指令系统因机而异，没有通用性。

指令中应包含的信息：执行的运算、运算结果的去向、运算数据的来源

**指令格式：**

```txt
操作码		 [操作数]	,	[操作数]
----- 	   --------     --------
   |			|			|
执行何种操作	目的操作数  ， 源操作数【参加操作的数据】

源操作数：指令加工前的数据
目的操作数：指令加工之后形成的数据

零操作数指令：操作码
单操作数指令：操作码	操作数
双操作数指令：操作码	目的操作数，源操作数

操作数形式：
立即数、寄存器、存储器
```

**********

### 1.1操作数形式

**立即数操作数：**

- 表示参加操作的数据本身，可以是8位或16位；
- 立即数无法作为目标操作数；
- 立即数可以是无符号或带符号数，其数值应在可取值范围内。

**寄存器操作数：**

- 表示参加运算的数存放在指令给出的寄存器中，可以是16位或8位。

**存储器操作数：**

- 表示当前参加运算的数存放在存储器的某一个或两个单元中。

**指令的字长与指令的执行速度：**

- 指令字长由操作码的长度、操作数地址长度、操作数个数决定
- 8088/8086 CPU采用变字长指令格式
- 指令的字长影响指令执行的速度
- 对不同的操作数，指令执行的时间不同：

```txt
存储器 → 立即数 → 寄存器
----------------------
慢		→		  快
```

***********************

### 1.2 8086的操作码

指令由操作码（Opcode）和操作数（地址码）组成。8086 的指令长度是可变的，一条指令般由 1~6字节组成（加上前级字节，最长可为7宇节)。指令的操作码采用二进制代码表示本指会所执行的操作，通常用指令的第一个字节表示。有时由于用8位不够，因此在指令的第二个字节中还可能占了位。除此以外的其他字节 （或位）用来表示操作数。
在多数操作码中，使用某些位来指示有关信息，常用的符号及含义如下：
◎W（字位）：表示本指令是对字（W=1）还是对字节（W=0）操作。

◎D（方向位）：表示参加操作的寄存器是作为目的操作数寄存器（D=1）还是作为源操作数寄存器（D=0）。

◎S（符号扩展位）：用于某些立即寻址的机器指令中。如果立即数为8位，但要求扩展成16位，则S=1；否则，S=0（所扩展的高8位要根据8位立即数的最高位来定）。

**********

### 1.3 8086指令中寄存器的编码

1. 指令的二进制一般形式

8086指令的二进制一般形式如下：`操作码 d/v/s w`

2. 编码模式

编码方式主要有以下三种：段寄存器编码、通用寄存器编码、内存寻址编码。

- 段寄存器编码

| 编码 | 段寄存器编码 |
| ---- | ------------ |
| 00   | ES           |
| 01   | CS           |
| 10   | SS           |
| 11   | DS           |

- 通用寄存器编码

| 编码 | 16位寄存器名 | 8位寄存器名 |
| ---- | ------------ | ----------- |
| 000  | AX           | AL          |
| 001  | CX           | CL          |
| 010  | DX           | DL          |
| 011  | BX           | XL          |
| 100  | SP           | AH          |
| 101  | BP           | CH          |
| 110  | SI           | DH          |
| 111  | DI           | BH          |

- 内存寻址编码

| r/m编码 | 基址寄存器 | 变址寄存器 |
| ------- | ---------- | ---------- |
| 000     | BX     +   | SI         |
| 001     | BX     +   | DI         |
| 010     | BP     +   | SI         |
| 011     | BP      +  | DI         |
| 100     |            | SI         |
| 101     |            | SI         |
| 110     | BP         |            |
| 111     | BX         |            |

8086指令中通常使用一个或两个操作数，在少数指令中隐含的第三个操作数。

### 1.4指令的寻址方式

指令的寻址方式就是寻找指令操作数所在地址的方式，以确定数据的来源和去处。

1. **立即寻址（立即数寻址）：**

指令操作数部分直接给出指令的操作数，它与指令操作码相接，顺序存放在代码中。立即数有8位和16位之分。

注意：

- 立即寻址方式只能用于源操作数，主要用于给寄存器赋值。
- 立即寻址方式不执行总线周期，执行速度快。

************

2. **寄存器寻址：**

- 操作数放在寄存器内，由指令直接给出某个寄存器的名字，以寄存器的内容作为操作数。
- 寄存器可以是16位的AX、BX、CX、DX、SI、DI、SP、BP寄存器，也可以是8位的AH、AL、BX、XL、CH、CL、DH、DL寄存器。

注意：

- 寄存器寻址方式的指令操作在CPU内部执行，不需要执行总线周期，执行速度快。
- 寄存器寻址方式既适用于指令的源操作数，也适用于目的操作数，并且可同时使用于源操作数和目的操作数。

*********

3. **直接寻址：**

操作数在存储器中，指令中直接给出操作数所在存储单元的有效地址EA，即段内偏移地址，表示操作数所在存储单元距离段首址的字节数。有效地址是一个无符号的16位二进制数。（直接给出偏移地址）

注意：

- 直接寻址方式的操作数所在存储单元的短地址一般在数据段寄存器DS中。（默认DS段）
- 如果操作数在其他段，则需要在指令中用段超越前缀指出相应的段寄存器名。

***********

4. **寄存器间接寻址：**

- 操作数在存储器中，指令中寄存器的内容作为操作数所在单元的有效地址EA（偏移地址）。寄存器仅限于BX、BP、SI、DI。

```txt
	|[SI]
	|[DI]
EA- |[BX]
	|[BP]
```

- 当使用BX、SI、DI时，操作数所在存储单元的段地址存在数据段寄存器DS中。
- 当使用BP时，操作数所在存储单元的段地址存在堆栈段寄存器SS中。

注意：

- 只有SI、DI、BX、BP可作为间接寻址器。
- 若操作指令所在存储单元不在数据段DS中，需要在指令中用段超越前缀表明其所在段的段名。

*********

5. **基址寻址：**

- 操作数在存储器内，指令中寄存器（BX或BP）的内容与指令指定的位移量之和作为操作数所在存储单元的有效地址EA（偏移地址）。

```txt
	|[BX]|
EA= |	 |->[8位或16位位移量]
	|[BP]|
```

- 当使用BX时，段地址为DS的内容；
- 当使用BP时，段地址为SS的内容。

**********

6. **变址寻址：**

- 操作数在存储器内，指令将变址寄存器SI、DI内容与指令指定的偏移位移量之和作为操作数所在存储单元的有效地址EA（偏移地址）。段地址规定为DS的内容。

```txt 
	|[SI]|
EA= |	 |->[8位或16位位移量]
	|[DI]|
```

*****

7. **基址加变址寄存器：**

- 操作数在内部寄存器内。指令将基址寄存器BX、BP与变址寄存器SI、DI的内容之和再加上之前的偏移量（8位或16位），得到操作数所在存储单元的有效地址EA。

```txt
	|[SI]|	 |[SI]|
EA= |	 | + |	  | + ->[8位或16位位移量]
	|[DI]|	 |[DI]|
```

- 当使用BX时，段地址寄存器为DS。
- 当使用BP时，段地址寄存器为SS。

```txt
MOV 寄存器,[BX/BP+SI/DI+n]
 // n为16进制地址,
```

******

8. **字符串寻址：**

- 用于字符串操作指令。规定变址寄存器SI中的内容是源数据串的段内偏移地址，而变址寄存器DI中的内容是目标数据串的段内偏移地址。
- 源数据串的地址规定是数据段DS，目标数据串的段地址规定是附加段ES。指令执行后SI和DI的内容自动增量（或减量），增（或减）值为1或2。

****

9. **I/O端口寻址：**（独立编址）

- 寻址输入输出设备的端口地址，可分为直接端口寻址和间接端口寻址。
- 直接端口寻址：由指令直接给出I/O设备的端口地址。它规定端口地址为8位，能寻址256个端口
- 间接端口寻址：由DX给出I/O设备的端口地址。由于DX是16位，因此间接端口地址能寻址多达64K个端口。

例如：

```txt
IN AL,20H;	将地址为20H的外设内容读入AL中。
OUT DX,AL;	AL中内容输出给以DX的内容为地址的外设。
```

*********

10. **隐含寻址：**

指令隐含了的一个或两个操作数的地址，即操作数在默认的地址中。

例如：

```txt
AAA;	对AL中的内容进行十进制加法调整，并把调整后的结果放入AH和AL中。这条指令的隐含操作数是AH和AL。
```



## 2.8086的指令系统

指令系统包括九大类、133种基本指令，通过寻址方式的变化与数据形式（字节、字型）的组合，可构成上千条指令。指令系统按功能分为：数据传送类、算数运算类、逻辑运算与移位类、串操作类、控制转移类、处理机控制、输入输出、中断等。

![](https://cdn.jsdelivr.net/gh/wfmiss/pictures/Principle_and_application_of_microcomputer/20210609231517.png)

******

### 2.1传送类指令

#### 2.1.1数据传送指令

数据传送类指令实现CPU内部寄存器之间、CPU与内存储器之间、CPU与I/O端口之间的数据传送。

**通用数据传送指令**

包括MOV、进栈（PUSH）、出栈指令（POP）、交换指令和换码指令。

- 一般数据传送指令MOV（8位/16位）

```txt
格式：MOV	OP目的操作数,OP源操作数
功能：OP源操作数 ——> OP目的操作数
要求：OP目 可以是寄存器（除CS外）、存储器 OP源可以是寄存器、存储器和立即数。
```

<img src="https://cdn.jsdelivr.net/gh/wfmiss/pictures/Principle_and_application_of_microcomputer/20210609170714.png" style="zoom: 33%;" />

该指令有如下9种形式：

```txt
MOV REG,REG			;通用寄存器间传送
MOV REG,IMM			;立即数送通用寄存器
MOV MEM,IMM			;立即数送存储器
MOV MEM,REG			;通用寄存器送存储器
MOV REG,MEM			;存储器送通用寄存器
MOV SEGREG,REG		;通用寄存器送段寄存器（CS除外）
MOV REG,SEGREG		;段寄存器送通用寄存器（含CS）
MOV SEGREG,MEM		;存储器送通用寄存器（CS除外）
MOV MEM,SEGREG		;段寄存器送存储器（含CS）
```

注意：

- MOV指令的两个操作数（源、目的）均可采用不同的寻址方式。
- 源操作数和目的操作数的类型必须一致。
- 源和目的不能都是存储器操作数。
- 不允许把立即数做目的操作数，也不允许向段寄存器（CS、DS、SS、ES）送立即数。

- 不允许在段寄存器之间、存储单元之间传送数据。
- CS、IP寄存器不能用作目的操作数。
- 一般传指令不影响标志位。

******

**堆栈操作指令**

堆栈：是按 “后进先出” 原则工作的一段存储区域。

堆栈寄存器SS —— 段地址

堆栈指针SP —— 始终单前栈顶所在的存储单元地址，即最新入栈数据所在存储单元的地址。

**压栈操作(进栈指令)：`PUSH OP(源操作数)`**

功能：把OP(源操作数)字节数据压入栈中，结果SP-2 ——> SP

原则：高字节压在高地址，低字节压在低地址

执行过程：

```txt
SP <-- SP - 1;		[SP] <-- OPH
SP <-- SP - 1;		[SP] <-- OPL
```

堆栈操作总是对16位的数据进行，指令中目的操作数隐含为堆栈。进栈操作把数据传输到以SS为段基址、SP为偏移地址的栈中。其操作过程如下：

- SP减一，指示堆栈中可以存放数据的位置，存放源操作数的高8位。
- SP再减一，存源操作数的迪8位，完成进栈操作。

**出栈操作(出栈指令)：`POP OP(目操作数)`**

功能：从栈中弹出数据 ——> OP(目操作数)，结果SP+2——>SP

执行过程：

```txt
OPL <-- [SP];		SP <—— SP+1
OPH <-- [SP];		SP <—— SP+1
```

例如：

```txt
已知：AX=1122H,BX=3344H,SP=1010H
执行指令：PUSH AX
		PUSH BX
		POP AX
		POP BX
执行后AX，BX，SP的结果？
解：AX=3344H
   BX=1122H
   SP=1010H
```

注意：

- 堆栈操作总是按字进行的。
- 压入指令，SP-2，数据在栈顶。弹出指令正好相反。
- 操作数可以是存储器、寄存器或段寄存器操作数 （CS不能用于POP），不能是立即数。

**********

#### 2.1.2目标地址传送指令

此类指令的功能是将操作数所在存储器的地址送入目标寄存器。

注意：

- OP源必须是存储器操作数，OP目必须是16为的通用寄存器。
- 地址传输指令不影响状态标志位。

*********

**取有效地址指令**

格式：`LEA 16位寄存器(OP目的操作数),源操作数偏移地址(OP源操作数)`

功能：存储器地址送到一个寄存器。

例如：

```txt
LEA SI,[2040H]
指令执行后，SI中的内容为2040H。又如：
MOV SI,[2040H]
指令执行后，SI中有偏移地址为2040H单元中的内容，而不是2040H这个值。
```

***********

**将地址指针装到DS和另一个寄存器的指令**

格式：`LDS 16位寄存器(OP目的操作数),源操作数偏移地址(OP源操作数)`

功能：把OP源指定的4个字节内容取出，低地址的两个字节—>OP目，高地址的两个字节—>DS。

例如：

```txt
LDS DI,[2130H]
2130H和2131H的单元中的内容送到DI；
2132H和2133H的单元中的内容送到DS；
```

************

**将地址指针装到ES和另一个寄存器的指令**

格式：`LES 16位寄存器(OP目的操作数),源操作数偏移地址(OP源操作数)`

功能：本指令与LDS指令的操作数基本相同，所不同的是将OP源4个字节中的高地址的两个字节—>ES。

例如：

```txt
LES DI,[2130H]
2130H和2131H的单元中的内容送到DI；
2132H和2133H的单元中的内容送到ES；
```

************

#### 2.1.3标志寄存器传送指令

**读取标志指令**

格式：`LAHF ; AH <— 标志寄存器低八位`

特点：此指令操作结果不影响标志寄存器。

********

**设置标志指令**

格式：`SAHF ; 标志寄存器低8位 <— AH`

特点：此之指令直接为标志寄存器的低8位赋值。

*******

**对标志寄存器的堆栈操作指令**

格式：`PUSHF ; 将标志寄存器的值压栈。`

​			`POPF ; 从栈顶弹出一个字送标志寄存器。`

特点：

- PUSHF不影响标志寄存器，而POPF直接为标志寄存器赋值。
- 通常两条指令成对出现，用来保护和恢复标志寄存器的内容。

**************

#### 2.1.4累加器专用传输指令

**数据交换指令**

格式：`XCHG OP1(目的操作数),OP1(源操作数)`

功能：实现OP1和OP2的内容的相互交换。

操作数：通用寄存器或存储器，但不能均为内存单元。

注意：段寄存器和IP不能作为交换指令的操作数。

***********

**换码指令（查表指令、翻译指令）**

换码指令是一条完成字节翻译功能的指令。它可以使累加器中的一个值变化为内存表格中的某一个值，一般用来实现编码制的转换。

格式：XLAT

功能：

```txt
[BX+AL] —> AL
	|----> EA
```

说明：将BX和AL内容相加作为有效地址EA，在一个表格中找出此单元中的内容—>AL。

BX——表格的首地址

AL——相对于表格首地址的位移量（要装换的代码）

注意：

- 使用前，先建立被转换代码（字节型）的数据表。
- 换码指令只能使用寄存器BX、AL，不影响标志位。

*************

**输入指令**

格式：`IN AL,n`

​			`IN AX,n`

​			`IN AL,DX`

​			`IN AX,DX`

说明：以上四种指令格式分别是8位/16位端口地址组合形式；指令中n表示为8位端口地址（00H~FFH），此时地址线高8位默认为0；当端口地址为16位时，指令中采用寄存器间接寻址，应先将16位端口地址传输到DX中，然后DX中的地址在IN指令中间接寻址。

*********

**输出指令**

**输入指令**

格式：`OUT n,AL`

​			`OUT n,AX`

​			`IN DX,AL`

​			`IN DX,AX`

OUT指令除源操作数和目的操作数与IN指令相反外，其他相同。

可见，无论是输入指令还是输出指令，其中地址部分的寻址方式要么是直接寻址，要么是寄存器寻址。

### 2.2算数运算类指令

8086的算数运算类指令能够对二进制或十进制（BCD码）数进行加、减、乘、除运算，操作数的数据形式可以是8位或16位的无符号数或带符号数。

#### 2.2.1加法指令

**不带进位的加法指令：**

格式：`ADD OP目,OP源 `

功能：OP目<— OP源+OP目，根据结果设置标志位（FR）。

注意：两操作数的类型相同，类型明确，不能同为存储器操作数。

**进位的加法指令**

格式：`ADC OP目,OP源`

功能：OP目<—OP源+OP目+CF，置标志位

说明：只要用于多字节运算，多字节运算时低位字节产生进位应加到高位。 

**加1指令**

格式：INC OP

功能：OP <— OP+1

说明：常用于修改偏移地址和计数次数。操作数可以是8/16位通用寄存器操作数，不能为立即数。

注意：

- INC指令不影响CF位，影响标志位AF、OF、PF、SF和ZF。
- 操作数视为无符号数。

总结：以上三条指令运算结果将影响状态标志位，但INC不影响标志CF。

以下为补充内容（非考点）

**对压缩BCD数加法操作的结果进行校正DAA**

格式：`DAA`

功能：对AL寄存器的内容进行十进制数调整。

说明：

- 要求参加操作的数必须是BCD数；
- 该指令用在压缩BCD数加法操作后，操作数隐含在AL中。

DAA指令调整方法：如果AF标志为1，或AL寄存器的低4位超出BCD数的计数符号（即为0AH~0FH）,则AL寄存器的内容加06H，且将AF置1；如果CF标志为1，或AL寄存器的高4位超出BCD数的计数符号（即为0AH~0FH），则AL寄存器的内容加60H，且将CF置1。

**对非压缩BCD数加法操作进行校正AAA**

格式：`AAA`

功能：对AL寄存器的内容进行十进制数调整。

说明：

- 要求参加操作的数必须是非压缩BCD数；
- 该指令用在非压缩BCD数加法操作后，操作数隐含在AL中；
- 由于该调整指令使用AH寄存器，故应先将AH内容清零。

AAA指令调整方法：

1. 如果AL寄存器指令的低4位在0~9之间，AF为0，则跳过第2步执行第3步；

2. 如果AL寄存器的低4位在0AH~0FH之间或AF为1，则AL寄存器的内容加06H，同时AH寄存器内容加1，且将AF置1；
3. AL寄存器的高4位清零；
4. AF位的值送CF。

#### 2.2.2减法指令

**不带借位的减法指令**

格式：`SUB OP目,OP源`

功能：OP目<— OP目-OP源，并根据结果设置标志

说明：

- 指令的目的操作数不能是立即寻址；
- 减法操作中产生的借位进入CF标志；
- 无符号操作数相减，若CF=1，则结果为补码；
- 带符号操作数相减要考虑溢出。

**带借位的减法指令**