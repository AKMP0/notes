---
title: Docker - 安装
date: 2021-06-02 23:33:02
permalink: /docker/install/
---

<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->


- [Docker的基本组成](#docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90)
- [环境说明](#%E7%8E%AF%E5%A2%83%E8%AF%B4%E6%98%8E)
- [安装步骤](#%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4)
- [阿里云镜像加速](#%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

## Docker的基本组成

::: tip 镜像（image）
:::

- 镜像（image）

Docker 镜像（Image）就是一个只读的模板。镜像可以用来创建 Docker 容器，一个镜像可以创建很 多容器。 就好似 Java 中的 类和对象，类就是镜像，容器就是对象！

- 容器（container）：

Docker 利用容器（Container）独立运行的一个或一组应用。容器是用镜像创建的运行实例。

它可以被启动、开始、停止、删除。每个容器都是相互隔离的，保证安全的平台。

可以把容器看做是一个简易版的 Linux 环境（包括root用户权限、进程空间、用户空间和网络空间等） 和运行在其中的应用程序

容器的定义和镜像几乎一模一样，也是一堆层的统一视角，唯一区别在于容器的最上面那一层是可读可写的。

- 仓库（repository）：

仓库（Repository）是集中存放镜像文件的场所。

仓库(Repository)和仓库注册服务器（Registry）是有区别的。仓库注册服务器上往往存放着多个仓 库，每个仓库中又包含了多个镜像，每个镜像有不同的标签（tag）。

仓库分为公开仓库（Public）和私有仓库（Private）两种形式

最大的公开仓库是 Docker Hub(https://hub.docker.com/)，存放了数量庞大的镜像供用户下载。 国内的公开仓库包括阿里云 、网易云 等



**小结：**

Docker 本身是一个容器运行载体或称之为管理引擎。我们把应用程序和配置依赖打包好形成一个 可交付的运行环境，这个打包好的运行环境就似乎 image镜像文件。只有通过这个镜像文件才能生 成 Docker 容器。image 文件可以看作是容器的模板。Docker 根据 image 文件生成容器的实例。 同一个 image 文件，可以生成多个同时运行的容器实例。

image 文件生成的容器实例，本身也是一个文件，称为镜像文件

一个容器运行一种服务，当我们需要的时候，就可以通过docker客户端创建一个对应的运行实例， 也就是我们的容器

至于仓库，就是放了一堆镜像的地方，我们可以把镜像发布到仓库中，需要的时候从仓库中拉下来 就可以了。

## 环境说明

我们使用的是 CentOS 7 (64-bit)

Docker 运行在 CentOS 7 上，要求系统为64位、系统内核版本为 3.10 以上。

**查看自己的内核：** 

用于打印当前系统相关信息（内核版本号、硬件架构、主机名称和操作系统类型 等）。

```sh
uname -r
```

**查看版本信息：**

```sh
cat /etc/os-release
```

## 安装步骤

官网安装参考手册：https://docs.docker.com/engine/install/centos/

1. yum安装gcc相关环境（需要确保虚拟机可以上外网 ）

   ```sh
   yum -y install gcc
   yum -y install gcc-c++
   ```

   

2. 卸载旧版本

   ```sh
   sudo yum remove docker \
                     docker-client \
                     docker-client-latest \
                     docker-common \
                     docker-latest \
                     docker-latest-logrotate \
                     docker-logrotate \
                     docker-engine
   ```

   

3. 安装需要的软件包

   ```sh
   sudo yum install -y yum-utils
   ```

   

4. 设置镜像仓库

   官网（国外）：

   ```sh
   sudo yum-config-manager \
       --add-repo \
       https://download.docker.com/linux/centos/docker-ce.repo
   ```

   阿里云（推荐）：

   ```sh
   sudo yum-config-manager \
       --add-repo \
   	http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
   ```

   

5. 更新yum软件包索引

   ```sh
   yum makecache fast
   ```

   

6. 安装 Docker CE

   ```sh
   yum install docker-ce docker-ce-cli containerd.io
   ```

   

7. 启动 Docker

   ```sh
   systemctl start docker
   ```

   至此，已经安装完



- 查看版本

  ```sh
  docker version
  ```

- 查看安装的镜像

  ```sh
  docker images
  ```

- 测试运行hello

  ```sh
  docker run hello-world
  ```



**卸载docker**

```sh
systemctl stop docker
yum -y remove docker-ce docker-ce-cli containerd.io
rm -rf /var/lib/docker
```



## 阿里云镜像加速

介绍：https://www.aliyun.com/product/acr

查看自己的镜像加速器并配置

<img src="https://cdn.jsdelivr.net/gh/oddfar/static/img/Docker.assets/04.Docker - 安装.assets/image-20210603161001649.png" alt="image-20210603161001649" style="zoom:67%;" />



```sh
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://cbl6xdl3.mirror.aliyuncs.com"]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
```

您可以通过修改daemon配置文件/etc/docker/daemon.json来使用加速器

![image-20210603160745479](https://cdn.jsdelivr.net/gh/oddfar/static/img/Docker.assets/04.Docker - 安装.assets/image-20210603160745479.png)



> 测试 HelloWorld

启动hello-world

```sh
docker run hello-world
```

run干了什么？

![img_18](https://cdn.jsdelivr.net/gh/oddfar/static/img/Docker.assets/04.Docker - 安装.assets/img_18.png)



